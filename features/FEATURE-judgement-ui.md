# Feature -> Judgement UI

## Overview

The Judgement UI is the final screen in the primary user flow (chat → comparison → judgement). It displays a playful, AI-generated text judgement about what the user's music taste says about them. This component completes the core value proposition and must be fully usable on mobile without horizontal scrolling.

---

## Requirements

### FR-JUDGE-001: Judgement Display (Core)
- Display AI-generated judgement text in a centered white rectangular container with black text
- Text content is formatted in TypeScript/React component (`.tsx`)
- Container is fully responsive—responsive to viewport size with appropriate padding/margins on mobile and desktop
- Support text length up to ~500 characters with proper line-wrapping
- Mobile-first: all content must fit on small screens (375px viewport) without horizontal scrolling

### FR-JUDGE-002: Loading State
- While the judgement is being generated by the AI, display a loading spinner inside the container
- Placeholder message ("Generating your judgement..." or similar) appears during loading
- Spinner must be clearly visible and centered

### FR-JUDGE-003: Error Handling
- If judgement generation fails, display a user-friendly error message in the container
- Include a "Retry" button to attempt generation again
- Error message must not expose technical details

### FR-JUDGE-004: Session Reset
- Provide a "Start New Session" button below or adjacent to the judgement box
- Button must be accessible on mobile without requiring scrolling
- Clicking the button clears the current session and returns the user to the chat flow

### FR-JUDGE-005: Testing Coverage
- Unit tests verify the component renders correctly with placeholder text
- Unit tests verify loading spinner appears and disappears appropriately
- Unit tests verify error state with retry button is displayed on failure
- Unit tests verify the "Start New Session" button triggers the correct callback
- (Integration tests for actual AI generation are in the LLM subsystem; this covers UI only)

### FR-JUDGE-006: Accessibility & UX
- Proper semantic HTML (e.g., role attributes if needed)
- "Start New Session" button is keyboard accessible
- Contrast meets readability standards (white box on black background)

---

## Alignment with Constitution

This feature directly supports:
- **User Story 1 (P1)**: Users receive a playful judgement completing the primary flow
- **User Story 2 (P2)**: Quick path still delivers a judgement at the end
- **Testing Requirement (Principle I)**: All functions of the judgement display are covered by unit tests
- **Mobile-First (FR-005)**: UI is fully usable on mobile without horizontal scrolling
- **FR-004**: System generates and displays the judgement
- **SC-002**: Judgement display/error recovery is fast; does not add latency to the 3-minute goal

---

## Implementation Plan

### Checkpoint 1: Base Component & Mobile Styling

**Goal**: Build the judgement container component with responsive styling.

- [ ] Create `src/components/JudgementDisplay.tsx` component
  - Accepts props: `judgement?: string` (AI text), `isLoading?: boolean`, `error?: string`, `onRetry: () => void`, `onNewSession: () => void`
  - Render centered white box with black text on black background
  - Use Tailwind CSS (or project's styling approach) for mobile-first responsive design
  - Mobile: 90vw width with padding, centered on screen
  - Desktop: max-width constraint for readability
  - No horizontal scrolling on 375px viewport
- [ ] Verify component works in Storybook or manual test (visual check)
- [ ] **Test**: Write unit tests in `src/components/JudgementDisplay.test.tsx`
  - Text rendering: component displays provided `judgement` prop correctly
  - Responsive snapshot test on mobile and desktop viewports

### Checkpoint 2: Loading & Error States ✅

**Goal**: Implement loading spinner and error handling UI.

- [x] Add loading spinner logic to `JudgementDisplay.tsx`
  - Show spinner when `isLoading === true`
  - Display "Generating your judgement..." placeholder text while loading
  - Hide spinner when judgement text arrives
- [x] Add error state UI
  - If `error` prop is provided, display error message instead of judgement
  - Show "Retry" button that calls `onRetry()` callback
  - Error message is user-friendly, no stack traces or API details
- [x] **Test**: Unit tests for state transitions
  - Test loading spinner visibility when `isLoading` is true/false
  - Test error message appears when `error` prop is set
  - Test "Retry" button fires `onRetry()` callback on click

### Checkpoint 3: Session Reset Button & Integration ✅

**Goal**: Add "Start New Session" button and prepare for parent integration.

- [x] Add "Start New Session" button below or adjacent to judgement box
  - Button text is clear and actionable
  - Button calls `onNewSession()` callback on click
  - Button is keyboard accessible and always visible (no scrolling required on mobile)
- [x] Verify button spacing and layout don't overflow on mobile
- [x] **Test**: Unit tests for button interactions
  - Test "Start New Session" button appears and is clickable
  - Test `onNewSession()` callback fires when button is clicked

### Checkpoint 4: Integration & End-to-End Testing ✅

**Goal**: Connect to the parent session flow and validate the complete path.

- [x] Integrate `JudgementDisplay` into the main session component/page
  - Wire up AI judgement output from the LLM service
  - Wire up error handling and retry logic
  - Wire up session reset to return to chat
- [x] Test the full flow in manual testing or Playwright e2e tests
  - Chat → Comparison → Judgement (with placeholder, actual AI integration in progress)
  - Verify judgement displays and buttons work end-to-end on mobile
  - Verify no horizontal scrolling on mobile
- [x] **Test**: E2E or integration test
  - Run through the judgement screen display, loading, and session reset
  - Verify all states are reachable and responsive on 375px viewport

---

## Notes

- Placeholder judgement text for early development: _"You've got eclectic taste with a love for introspection—the kind of person who curates playlists like they're building a personality."_
- Styling approach (Tailwind, CSS modules, etc.) should match the rest of the project; verify with existing components.
- The actual judgement text comes from the LLM after collecting vibe and comparison data; this component only displays it.